<f:composition xmlns="http://www.w3.org/1999/xhtml"
               xmlns:p="primefaces"
               xmlns:f="jakarta.faces.facelets"
               xmlns:f2="jakarta.faces.core"
               xmlns:crud="jakarta.faces.composite/crud"
               template="WEB-INF/Templates/Principal.xhtml"
               xmlns:h="jakarta.faces.html">

    <h1>
        <f:define name="Titulo">
            #{frmReserva.tituloPagina}
        </f:define>
    </h1>

    <f:define name="Cuerpo">
        <h:panelGrid>
            <h:panelGroup id="pnlSteps">
                <p:tabView id="tabSteps" cache="false" dynamic="true" rendered="#{frmReserva.estado != NONE}">
                    <p:ajax process="@this" event="tabChange" listener="#{frmReserva.cambiarTab}"/>

                    <!-- ######## Fecha de la reserva ######## -->
                    <p:tab title="Fecha" closable="false">
                        <h:panelGrid>
                            <h:form id="frmFecha">
                                <h:panelGrid>
                                    <h:panelGrid columns="2">
                                        <h:outputLabel value="Tipo de Reserva" for="trList"/>
                                        <h:selectOneMenu id="trList" value="#{frmReserva.idTipoReservaSeleccionado}">
                                            <f2:selectItem value="Seleccione un tipo" itemValue="i1"
                                                           noSelectionOption="true"/>

                                            <f2:selectItems
                                                    value="#{frmReserva.trList}"
                                                    var="tr"
                                                    itemLabel="#{tr.nombre}"
                                                    itemValue="#{tr.idTipoReserva}"/>
                                            <f2:ajax execute="@this" render="txtFecha"/>
                                        </h:selectOneMenu>

                                        <h:outputLabel value="Seleccione un día" for="txtFecha"/>
                                        <p:datePicker id="txtFecha" value="#{frmReserva.frmProgramacion.localDesde}"
                                                      pattern="yyyy-MM-dd HH:mm" showTime="true" required="true">

                                            <p:ajax event="dateSelect" update="@this" process="@this"/>
                                        </p:datePicker>

                                    </h:panelGrid>
                                </h:panelGrid>

                                <p:commandButton ajax="true"
                                                 actionListener="#{frmReserva.cambiarTab}"
                                                 value="#{abstractpffprm['abstractpffprm.next']}"
                                                 process="@this" update="#{cc.attrs.actualizar}"
                                                 rendered="#{cc.attrs.frm.estado != 'NONE'}"/>
                            </h:form>
                        </h:panelGrid>
                    </p:tab>

                    <p:tab title="Función" closable="false">
                        <h:panelGrid>
                            <h:form id="frmFuncion">
                                <h:panelGrid columns="2">
                                    <h:outputLabel value="Seleccione una Película" for="txtPelicula"/>
                                    <h:selectOneMenu id="txtPelicula" value="#{frmReserva.idTipoReservaSeleccionado}">
                                        <f2:selectItem value="Seleccione una pelicula" itemValue="i1"
                                                       noSelectionOption="true"/>

                                        <f2:selectItems
                                                value="#{frmReserva.funciones}"
                                                var="fn"
                                                itemLabel="#{fn.idPelicula.nombre} #{fn.idSala.nombre} - #{fn.idSala.idSucursal.nombre} (#{fn.desde}-#{fn.hasta})"
                                                itemValue="#{fn.idProgramacion}"/>
                                        <f2:ajax execute="@this" render=""/>
                                    </h:selectOneMenu>
                                </h:panelGrid>

                                <p:commandButton ajax="true"
                                                 actionListener="#{frmReserva.cambiarTab}"
                                                 value="#{abstractpffprm['abstractpffprm.back']}"
                                                 process="@this" update="#{cc.attrs.actualizar}"
                                                 rendered="#{cc.attrs.frm.estado != 'NONE'}"/>


                                <p:commandButton ajax="true"
                                                 actionListener="#{frmReserva.cambiarTab}"
                                                 value="#{abstractpffprm['abstractpffprm.next']}"
                                                 process="@this" update="#{cc.attrs.actualizar}"
                                                 rendered="#{cc.attrs.frm.estado != 'NONE'}"/>
                            </h:form>
                        </h:panelGrid>
                    </p:tab>
                </p:tabView>
            </h:panelGroup>
        </h:panelGrid>
    </f:define>
</f:composition>